<div class="onecx-page-header mb-4" name="ocx-page-header-wrapper">
  @if (showBreadcrumbs) { @if (breadcrumbs$ | async ; as items) {
  <p-breadcrumb
    [model]="items"
    [home]="(home$ | async)?.menuItem ?? {}"
    [homeAriaLabel]="(home$ | async)?.page ? ('OCX_PAGE_HEADER.HOME_ARIA_LABEL' | translate: { page: (home$ | async)?.page}) : ('OCX_PAGE_HEADER.HOME_DEFAULT_ARIA_LABEL' | translate)"
    [attr.manual]="manualBreadcrumbs"
  ></p-breadcrumb>
  } }
  <div class="title-bar flex flex-row md:justify-content-between align-items-center p-3">
    <div class="title-wrap">
      @if (showFigure) {
      <div class="mr-2 figure relative flex h-2rem w-2rem md:h-3rem md:w-3rem">
        <div #previewImage class="figure-image absolute top-0 left-0 right-0 bottom-0">
          <ng-content select="[figureImage]"></ng-content>
          @if (figureImage && !figureImageLoadError) {
          <img [ocxSrc]="figureImage" alt="Figure Image" class="w-full border-round-sm" (error)="handleImageError()" />
          }
        </div>
        @if (previewImage.children.length === 0 || figureImageLoadError) {
        <div class="colorblob flex-1 border-round"></div>
        }
      </div>
      } @if (!loading) {
      <div class="header">
        @if (!!header) {
        <h1 id="page-header">{{ header }}</h1>
        } @if (!!subheader) {
        <div id="page-subheader" role="note" [attr.aria-label]="'OCX_PAGE_HEADER.SUBHEADER' | translate">
          {{ subheader }}
        </div>
        }
      </div>
      } @else {
      <div class="header justify-content-evenly">
        <p-skeleton width="10rem"></p-skeleton>
        <p-skeleton width="10rem"></p-skeleton>
      </div>
      }
    </div>

    <div class="action-items-wrap mt-2 md:mt-0">
      @if (additionalToolbarContentLeft) {
      <ng-container [ngTemplateOutlet]="additionalToolbarContentLeft"> </ng-container>
      } @if (!loading) { @if( inlineActions$ | async; as inlineActions) { @if (inlineActions && inlineActions.length >
      0) {
      <div class="toolbar flex flex-wrap gap-1 sm:gap-2">
        @for (action of inlineActions; track action) {
        <span
          [ocxTooltip]="action.disabled ? (action.disabledTooltipKey ? (action.disabledTooltipKey | translate) : action.disabledTooltip) : (action.titleKey ? (action.titleKey | translate) : action.title)"
          tooltipPosition="top"
          tooltipEvent="hover"
        >
          <p-button
            [id]="action.id"
            [icon]="action.icon ?? ''"
            [iconPos]="action.iconPos ?? 'left'"
            type="button"
            class="action-button"
            (onClick)="onActionClick(action)"
            [disabled]="action.disabled ? action.disabled : false"
            [loading]="action.loading ?? false"
            [attr.name]="action.icon ? 'ocx-page-header-inline-action-icon-button' : 'ocx-page-header-inline-action-button'"
            [label]="action.labelKey ? (action.labelKey | translate) : action.label"
            [ariaLabel]=" (action.ariaLabelKey ? (action.ariaLabelKey | translate) : action.ariaLabel) || (action.titleKey ? (action.titleKey | translate) : action.title) || (action.labelKey ? (action.labelKey | translate) : action.label)"
          ></p-button>
        </span>
        }
      </div>
      } }
      <ng-content select="[toolbarItems]"></ng-content>
      <ng-container>
        @if(overflowActions$ | async; as overflowActions) {@if (overflowActions.length !== 0) {
        <div>
          <button
            id="pageHeaderMenuButton"
            type="button"
            pButton
            icon="pi pi-ellipsis-v"
            class="more-actions-menu-button action-button ml-2"
            (click)="menu.toggle($event)"
            name="ocx-page-header-overflow-action-button"
            [attr.aria-label]="'OCX_PAGE_HEADER.MORE_ACTIONS' | translate"
            [ocxTooltip]="'OCX_PAGE_HEADER.MORE_ACTIONS' | translate"
            tooltipEvent="hover"
            tooltipPosition="top"
          ></button>
          <p-menu #menu [popup]="true" [model]="overflowActions" appendTo="body"></p-menu>
        </div>
        } }
      </ng-container>
      } @else {
      <div class="flex">
        <p-skeleton shape="circle" size="2rem" styleClass="mr-2"></p-skeleton>
        <p-skeleton shape="circle" size="2rem" styleClass="mb-2"></p-skeleton>
      </div>
      } @if (additionalToolbarContent) {
      <ng-container [ngTemplateOutlet]="additionalToolbarContent"> </ng-container>
      }
    </div>
  </div>

  <div class="object-panel" [ngClass]="getObjectPanelLayoutClasses()">
    @if (objectDetails) { @for (item of objectDetails; track item) {
    <div class="object-info" [ngClass]="getObjectInfoLayoutClasses()">
      <span
        class="flex font-medium text-600 object-info-grid-label"
        name="object-detail-label"
        [ocxTooltip]="item.labelTooltipKey ? ((typeof item.labelTooltipKey === 'string' ? item.labelTooltipKey : item.labelTooltipKey.key) | translate : (typeof item.labelTooltipKey === 'object' ? item.labelTooltipKey.parameters : undefined)) : ''"
        tooltipEvent="hover"
        tooltipPosition="top"
      >
        {{ item.label | dynamicPipe:item.labelPipe }}
      </span>
      @if (item.icon || item.value) {
      <span class="object-info-grid-value">
        <span
          class="flex text-900 align-items-center gap-2 w-max"
          [ngClass]="generateItemStyle(item)"
          name="object-detail-value"
        >
          <span
            class="flex align-items-center gap-2"
            [ocxTooltip]="item.valueTooltipKey ? ((typeof item.valueTooltipKey === 'string' ? item.valueTooltipKey : item.valueTooltipKey.key) | translate : (typeof item.valueTooltipKey === 'object' ? item.valueTooltipKey.parameters : undefined)) : ''"
            tooltipEvent="hover"
            tooltipPosition="top"
          >
            @if (item.icon) {
            <i [class]="item.icon + ' ' + (item.iconStyleClass ?? '')" name="object-detail-icon"></i>
            } {{ item.value | dynamicPipe:item.valuePipe:item.valuePipeArgs}}
          </span>
          @if (item.actionItemIcon && item.actionItemCallback) {
          <p-button
            [icon]="item.actionItemIcon"
            styleClass="p-button-text p-0 w-full"
            [ariaLabel]="item.actionItemAriaLabelKey ? ((typeof item.actionItemAriaLabelKey === 'string' ? item.actionItemAriaLabelKey : item.actionItemAriaLabelKey.key) | translate : (typeof item.actionItemAriaLabelKey === 'object' ? item.actionItemAriaLabelKey.parameters : undefined)) : 'button for ' + item.actionItemIcon"
            [ocxTooltip]="item.actionItemTooltipKey ? ((typeof item.actionItemTooltipKey === 'string' ? item.actionItemTooltipKey : item.actionItemTooltipKey.key) | translate : (typeof item.actionItemTooltipKey === 'object' ? item.actionItemTooltipKey.parameters : undefined)) : ''"
            tooltipPosition="top"
            tooltipEvent="hover"
            (onClick)="item.actionItemCallback()"
          ></p-button>
          }
        </span>
      </span>
      }
    </div>
    } }
    <ng-content></ng-content>
  </div>
</div>
